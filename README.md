# 옷을 골라주는 인공지능

* 계명대학교 컴퓨터공학과 캡스톤디자인  
* 개발기간 : 2022.03 ~ 2022.06  
* 개발인원 : 5명  

## 목적 및 필요성
단순히 통계형 알고리즘을 사용하여 유저에게 추천해주기보다 개개인의 구매 기록 및 나이, 계절 등을 고려하여 개인화된 추천 시스템을 유저에게 제공한다면 유저의 구매를 부축이는 효과를 얻을 수 있을 뿐만 아니라 다른 온라인 쇼핑몰과의 차별점을 가질 수 있다고 생각했다.
사용자에게 이미지 & 스케치 이미지 검색 기능을 제공함으로써 사용자는 자신이 가지고 있는 사진으로 홈페이지 내의 비슷한 옷에 대해 검색할 수 있다. 또한 사진이 없을 경우 스케치를 통해 옷을 검색 할 수 있다. 이는 사용자가 원하는 옷을 더 정확히 검색하는 기능을 제공 할 뿐만 아니라 쇼핑몰에 대한 흥미를 유발함으로써 고객을 확보할 수 있는 효과를 지닌다. 

## 제품설계

### 추천 시스템
1. 아이템 기반 추천시스템 – 옷들의 유사도를 측정하기 위해서는 옷들이 가지고 있는 특징을 알아낼 필요가 있었다. 처음 데이터베이스에는 옷의 이미지나 제목만 들어있었기 때문에 딥러닝을 통해 옷의 이미지를 알아내고자 했다. IMaterialist 라는 옷의 이미지와 옷의 특징들이 매칭되어있는 데이터셋을 활용해 옷의 이미지로부터 옷의 특징을 뽑아낼 수 있는 모델을 학습시켰다. 이때 resnet50의 imagenet 모델이 사용되었다. 학습완료된 모델을 사용하여 DB에 있는 옷들의 특징을 뽑아낸 후 DB에 저장시켰다. 특징들을 살펴보았을 때 명사와 명사가 합쳐져있는 합성어의 경우가 있어 이를 자연어처리를 통해 분리해 주었다. 그 후 자연어처리를 통해 특징들을 벡터로 나타내었고 유저가 옷을 살 때 마다 그 옷에 해당하는 벡터가 유저에게 업데이트 되도록 하였다. 따라서 유저에게 옷을 추천해 줄때는 유저가 가진 벡터와 옷들의 벡터를 코사인 유사도를 통해 계산한 뒤 유사도가 높은 상품들을 추천해 줄 수 있도록 설계하였다.

2. 유저 기반 추천시스템 – 먼저 유저와 아이템들을 행렬로 만든다. 이때 행렬의 값은 유저가 해당 아이템에 매긴 평점이 된다. 모든 아이템들과 모든 유저들에 대한 행렬을 만들게 되면 유저들이 구매한 수 보다 DB에 있는 옷들의 수가 훨씬 많기 때문에 대부분의 값들이 0으로 채워진 희소 행렬이 만들어진다. 이러한 희소행렬의 비어있는 값들을 예측 값들로 채우기 위해 Alternative Least Square(ALS)라는 알고리즘을 사용하였다. ALS 알고리즘은 사용자 행렬을 최적화 해주는 과정과 아이템 행렬을 최적화 해주는 과정 반복하며 예측값을 찾아낸다. 따라서 예측된 값들을 정렬하여 유저의 긍정적인 평가가 예상되는 아이템을 추천해 준다.

### 검색 시스템

1. 이미지 & 스케치 이미지 검색 시스템 – 우선 이미지 검색의 경우 DB에 있는 옷 이미지들을 resnet50 모델을 사용해 이미지 특징들을 추출 한 뒤 해당 값들로 이미지들 간의 유클리드 거리 측정을 통해 최근접에 이웃해 있는 K개의 이미지들을 찾는 방식으로 구현하였다. 사용자가 검색한 이미지가 서버로 들어오면 같은 resnet50 모델을 통해 비슷한 이미지를 찾는다. 스케치 이미지의 경우 모델 학습을 위해 스케치된 이미지가 필요하였다. 따라서 pre-trained 된 모델을 사용해 DB에 있는 옷 이미지로부터 스케치 이미지를 뽑아내었다. 그 후 스케치된 이미지를 resnet50 모델에 학습시켰다. 만약 유저가 스케치 이미지로 검색을 한다면 해당 스케치는 서버로 들어온 후 resnet50 모델을 거쳐 비슷한 스케치 이미지를 찾는다. 이때 스케치 이미지와 실제 이미지는 1:1 매칭이 되어있기 때문에 실제 이미지를 바로 유저에게 제공할 수 있다.

### 서버

Flask를 사용해 백엔드 서버를 구현하였고 SqlAlchemy를 통해 DB를 관리하였다. DB에는 옷들의 정보, 유저 정보, 유저의 구매 기록 및 평점 등이 있다. 책들의 벡터 값이나 유저의 벡터 값은 csv 파일로 관리되게 하였다. 프론트엔드에서는 이미지 검색과 스케치 이미지 검색을 위해 홈페이지에서 사진을 첨부하거나 웹캠을 연결하여 사진을 찍어 검색할 수 있는 기능을 제공하였다. 또한 스케치를 할 수 있는 그림판을 제공하여 사용자가 좀 더 편리하게 검색 기능을 사용할 수 있도록 하였다. 또한 사용자는 옷 추천 페이지에서 계절이나 성별, 상황 등을 필터링 할 수있는데 이를 쿠키 및 local storage에 저장되게 하여 다음에 방문 시에도 해당 정보가 저장되게 하였다.

## 수행 및 고찰

### 결과물
- 웹 페이지 메인 화면  
![1](https://user-images.githubusercontent.com/70793467/195830954-76adc05e-aa52-4acc-8ab9-2c55cfd072b3.png)  
페이지 상단에는 로그인, 회원가입, 검색창이 있고 좌측에는 카테고리를 선택할 수 있는 창이 있으며 페이지의 중앙에는 상품의 이미지와 이름을 보여준다.  

- 로그인 및 회원가입 화면  
![2](https://user-images.githubusercontent.com/70793467/195831304-879e7341-b999-4742-8a8c-30982d349e5e.png)  
사용자는 회원가입 및 로그인을 진행할 수 있다. 사용자는 회원가입 시 선호하는 의류 항목을 선택하여 개인화된 추천 시스템 서비스를 제공 받을 수 있다.  

- 상품 추천 화면  
![3](https://user-images.githubusercontent.com/70793467/195831312-01c97279-3cfa-4b9a-97e6-754a77281686.png)  
로그인 후 추천 페이지에 들어가면 개인화된 추천 시스템에 따라 옷 추천을 받을 수 있다. 사용자는 계절, 성별, 상황을 선택함으로써 고려되는 요소들을 구체화 할 수 있다.  

- 상품 상세 페이지  
![4](https://user-images.githubusercontent.com/70793467/195831316-0d022258-ceef-4d2b-8de8-13a58066900e.png)  
사용자가 상품 목록에서 상품을 선택하면 상품의 상세 페이지로 이동한다. 해당 페이지에서는 제품의 정보를 간략하게 볼 수 있고 구매하기 버튼을 통해 구매할 수 있다. 사용자가 옷을 구매 할 시 평점을 남길 수 있는 버튼이 추가된다. 또한 해당 옷과 비슷한 옷들을 같이 보여준다.  

- 스케치 이미지 검색  
![5](https://user-images.githubusercontent.com/70793467/195831320-3017d1b7-1200-4fd0-bc7e-bddd60e45644.png)  
스케치를 통해 사용자가 검색하고자 하는 상품의 대략적인 모습을 그림으로 그려, 비슷한 상품을 검색하는 기능을 제공한다.  

- 카메라를 통한 이미지 검색  
![6](https://user-images.githubusercontent.com/70793467/195831323-b9a6b7c6-bd32-4889-b1b4-07e774b2c570.png)  
이미지 검색을 위해 홈페이지 내에서 카메라 기능을 사용하여 사진 촬영이 가능하여 사진과 비슷한 옷을 추천한다.  

### 문제점 및 해결 노력
*  딥러닝 연산을 거치는 이미지 & 스케치 이미지 검색 기능의 경우 응답에 시간이 다소 걸릴 수 있는 문제가 있다.
*  카메라를 통한 이미지 검색 시 주변 배경이 고려됨에 따라 이미지 검색의 정확성이 떨어진다는 문제가 있다.
* 상품 추천 시 한가지 카테고리에 집중되어 추천되는 경우가 있어 카테고리 별로 개수 제한을 두어 조금더 다양한 옷들이 추천될 수 있게 하였다.

